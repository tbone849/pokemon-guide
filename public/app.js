angular.module("pokemon",["ngAnimate","angular-velocity","ngRoute","ngLodash"]).config(["$routeProvider","$sceDelegateProvider",function(e,n){e.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).when("/pokemon",{templateUrl:"views/browse.html",controller:"BrowseController"}).when("/search",{templateUrl:"views/search.html",controller:"PokemonNameController"}).when("/pokemon/:name",{templateUrl:"views/pokemon-detail.html",controller:"PokemonDetailController"}).otherwise({redirectTo:"/"}),n.resourceUrlWhitelist(["self","http://pokeapi.co/api/v2/**"])}]),angular.module("pokemon").controller("BrowseController",["$scope","$http","$routeParams","lodash",function(e,n,o,t){e.currentPage=parseInt(o.page);var a="";a=1===e.currentPage?0:30*(e.currentPage-1);var r=function(e){var n=e.split("/"),o=n[6];return"http://pokeapi.co/media/sprites/pokemon/"+o+".png"},i=function(e){var n=e.map(function(e){return{name:e.name,sprite:r(e.url)}});return n},l=function(o){n.get("http://pokeapi.co/api/v2/pokemon/?limit=30&offset="+o).then(function(n){e.pages=t.range(1,Math.ceil(n.data.count/30)+1),e.pokemon=i(n.data.results)},function(e){console.log("Group retrieval failed.")})};l(a)}]),angular.module("pokemon").controller("HomeController",["$location","$route","$scope",function(e,n,o){o.$watch(function(){return e.path()},function(e){"/"===e?o.home=!0:o.home=!1})}]),angular.module("pokemon").controller("PokemonDetailController",["$scope","PokemonDetailFactory","PokemonEvolutionFactory","PokemonSpeciesFactory","$routeParams",function(e,n,o,t,a){e.name=a.name;var r=0,l=0,c=function(e){var n=1;for(i=0;i<e.chain.evolves_to.length;i++)for(n++,z=0;z<e.chain.evolves_to[i].evolves_to.length;z++)n++;return n};e.areImagesLoaded=function(){r++,l===r&&l>1?e.$apply(function(){e.imagesLoaded=!0}):l===r&&1===l&&e.$apply(function(){e.hideEvolutionResponse=!0})},e.hideEvolution=function(){e.hideEvolutionResponse=!0,console.log("hide evolution")},n.getDetails(e.name).then(function(o){return e.pokemon=n.parsePersonalTraits(o.data),t.getSpecies(e.pokemon.species.url)},function(e){console.log("Details failed"),console.log(e)}).then(function(n){return e.species=t.parseSpecies(n.data),o.getEvolutionChain(e.species.evolutionChainUrl)},function(e){console.log("Species failed"),console.log(e)}).then(function(n){e.evolution=n.data,l=c(e.evolution)},function(e){console.log("Evolution failed"),console.log(e)})}]),angular.module("pokemon").controller("PokemonNameController",["$scope","PokemonNameFactory",function(e,n){e.loaded=!1,n.getAllNames(function(n,o){return n?console.log(n):void(void 0!==o&&(e.loaded=!0,e.names=o))})}]),angular.module("pokemon").directive("back",["$window",function(e){return{link:function(n,o,t){o.on("click",function(){e.history.back()})}}}]),angular.module("pokemon").directive("fallbackSrc",function(){var e={link:function(e,n,o){n.bind("error",function(){angular.element(this).attr("src",o.fallbackSrc)})}};return e}),angular.module("pokemon").directive("paginate",["$location",function(e){return{restrict:"E",scope:{pages:"=",currentPage:"="},templateUrl:"views/paginate.html",link:function(e,n,o){e.$watch("pages",function(n){n&&(e.currentPage<4||e.pages.length<6?e.start=0:e.pages.length-e.currentPage<3?e.start=e.pages.length-5:e.start=e.currentPage-3)})}}}]),angular.module("pokemon").directive("pokemon",["$location",function(e){return{restrict:"E",scope:{name:"=",spriteUrl:"="},transclude:!0,templateUrl:"views/pokemon.html",link:function(n,o,t){o.bind("click",function(){var o="/pokemon/"+n.name;n.$apply(function(){e.url(o)})})}}}]),angular.module("pokemon").directive("sprite",["$http","$location",function(e,n){return{restrict:"E",scope:{name:"=",loaded:"&",hide:"&"},template:'<img class="sprite" ng-src="{{url}}" width="96" height="96"><span class="sprite-label">{{name | titlecase}}</span>',link:function(o,t,a){var r=function(e){switch(e){case"pumpkaboo":return e="pumpkaboo-average";case"gourgeist":return e="gourgeist-average";case"wormadam":return e="wormadam-plant";case"aegislash":return e="aegislash-shield";case"darmanitan":return e="darmanitan-standard";case"meowstic":return e="meowstic-male";default:return e}},i=function(n,o){e.get("//pokeapi.co/api/v2/pokemon/"+r(n)+"/",{cache:!0}).then(function(e){var n="http://pokeapi.co/media/sprites/pokemon/"+e.data.id+".png";o(null,n)},function(e){o(e)})};i(o.name,function(e,n){e&&(console.log(e),t.find("img").attr("src","./assets/img/pokeball.png"),o.hide()),void 0!==n&&(o.url=n)}),t.find("img").on("load",function(){o.loaded()}),t.bind("click",function(){var e="/pokemon/"+r(o.name);o.$apply(function(){n.url(e)})})}}}]),angular.module("pokemon").factory("PokemonDetailFactory",["$http",function(e){var n=function(e){var n=e.map(function(e){return e.type.name});return n},o=function(e){var n=e.map(function(e){return e.ability.name});return n},t=function(e){var n=Math.round(e/2.54),o=(n/12).toFixed(1);return o+" ft"},a=function(e){var n=(e/10*2.2046).toFixed(2);return n+" lbs"};return{getDetails:function(n){return e.get("//pokeapi.co/api/v2/pokemon/"+n+"/",{cache:!0})},parsePersonalTraits:function(e){var r={height:{ft:t(10*e.height),m:(e.height/10).toFixed(2)+" m"},weight:{lbs:a(e.weight),kg:(e.weight/10).toFixed(2)+" kg"},type:n(e.types),stats:e.stats,abilities:o(e.abilities),species:e.species,sprites:{male:e.sprites.front_default||"./assets/img/pokeball.png",female:e.sprites.front_female||"./assets/img/pokeball.png"}};return r}}}]),angular.module("pokemon").factory("PokemonEvolutionFactory",["$http",function(e){return{getEvolutionChain:function(n){return e.get(n,{cache:!0})}}}]),angular.module("pokemon").factory("PokemonNameFactory",["$http","lodash",function(e,n){var o=function(e){var n=e.map(function(e){return e.name});return n};return{getAllNames:function(n){e.get("//pokeapi.co/api/v2/pokemon/",{cache:!0}).then(function(t){var a=t.data.count;e.get("//pokeapi.co/api/v2/pokemon/?limit="+a,{cache:!0}).then(function(e){n(null,o(e.data.results))}).then(function(e){n(e)})}).then(function(e){n(e)})}}}]),angular.module("pokemon").factory("PokemonSpeciesFactory",["$http",function(e){var n=function(e){return null===e?null:e.name},o=function(e){return-1===e?{male:null,female:null,genderless:"Genderless"}:{male:Math.floor((8-e)/8*100)+"%",female:Math.floor(e/8*100)+"%",genderless:!1}};return{getSpecies:function(n){return e.get(n,{cache:!0})},parseSpecies:function(e){var t={name:e.name,genderRate:o(e.gender_rate),captureRate:e.capture_rate,growthRate:e.growth_rate.name,color:e.color.name,evolutionChainUrl:e.evolution_chain.url,generation:e.generation.name,habitat:n(e.habitat)||"unavailable",genus:e.genera[0].genus,varieties:e.varieties};return t}}}]),angular.module("pokemon").filter("myLimitTo",function(){return function(e,n,o){return e.slice(o,o+n)}}),angular.module("pokemon").filter("titlecase",["lodash",function(e){return function(n){var o=["i","ii","iii","iv","v","vi","vii","viii","ix","x"],t=n.split("-"),a=t.map(function(n){return o.indexOf(n)>-1?n.toUpperCase():e.capitalize(n)}),r=a.join(" ");return r}}]);