angular.module("pokemon",["ngAnimate","angular-velocity","ngRoute","ngLodash"]).config(["$routeProvider","$sceDelegateProvider",function(e,o){e.when("/",{templateUrl:"views/home.html"}).when("/pokemon",{templateUrl:"views/browse.html",controller:"BrowseCtrl"}).when("/search",{templateUrl:"views/search.html",controller:"PokemonNameController"}).when("/pokemon/:name",{templateUrl:"views/pokemon-detail.html",controller:"PokemonDetailController"}).otherwise({redirectTo:"/"}),o.resourceUrlWhitelist(["self","http://pokeapi.co/api/v2/**"])}]),angular.module("pokemon").controller("PokemonDetailController",["$scope","PokemonDetailFactory","PokemonEvolutionFactory","PokemonSpeciesFactory","$routeParams",function(e,o,n,t,a){e.name=a.name;var r=0,l=0,u=function(e){var o=1;for(i=0;i<e.chain.evolves_to.length;i++)for(o++,z=0;z<e.chain.evolves_to[i].evolves_to.length;z++)o++;return o};e.areImagesLoaded=function(){r++,l===r&&l>1?e.$apply(function(){e.imagesLoaded=!0}):l===r&&1===l&&e.$apply(function(){e.hideEvolutionResponse=!0})},e.hideEvolution=function(){e.hideEvolutionResponse=!0,console.log("hide evolution")},o.getDetails(e.name).then(function(n){return e.pokemon=o.parsePersonalTraits(n.data),t.getSpecies(e.pokemon.species.url)},function(e){console.log("Details failed"),console.log(e)}).then(function(o){return e.species=t.parseSpecies(o.data),console.log(e.species),n.getEvolutionChain(e.species.evolutionChainUrl)},function(e){console.log("Species failed"),console.log(e)}).then(function(o){e.evolution=o.data,l=u(e.evolution)},function(e){console.log("Evolution failed"),console.log(e)})}]),angular.module("pokemon").controller("PokemonNameController",["$scope","PokemonNameFactory",function(e,o){e.loaded=!1,o.getAllNames(function(o,n){return o?console.log(o):void(void 0!==n&&(e.loaded=!0,e.names=n))})}]),angular.module("pokemon").directive("sprite",["$http",function(e){return{restrict:"E",scope:{name:"=",loaded:"&",hide:"&"},template:'<img class="sprite" ng-src="{{url}}" width="96" height="96"><span class="sprite-label">{{name | titlecase}}</span>',link:function(o,n,t){var a=function(o,n){e.get("//pokeapi.co/api/v2/pokemon/"+o+"/").then(function(e){var o="http://pokeapi.co/media/sprites/pokemon/"+e.data.id+".png";n(null,o)},function(e){n(e)})};a(o.name,function(e,t){e&&(console.log(e),n.find("img").attr("src","./assets/img/pokeball.png"),o.hide()),void 0!==t&&(o.url=t)}),n.find("img").on("load",function(){o.loaded()})}}}]),angular.module("pokemon").factory("PokemonDetailFactory",["$http",function(e){var o=function(e){var o=e.map(function(e){return e.type.name});return o},n=function(e){var o=e.map(function(e){return e.ability.name});return o},t=function(e){var o=Math.round(e/2.54),n=(o/12).toFixed(1);return n+" ft"},a=function(e){var o=(e/10*2.2046).toFixed(2);return o+" lbs"};return{getDetails:function(o){return e.get("//pokeapi.co/api/v2/pokemon/"+o+"/",{cache:!0})},parsePersonalTraits:function(e){var i={height:{ft:t(10*e.height),m:(e.height/10).toFixed(2)+" m"},weight:{lbs:a(e.weight),kg:(e.weight/10).toFixed(2)+" kg"},type:o(e.types),stats:e.stats,abilities:n(e.abilities),species:e.species,sprites:{male:e.sprites.front_default||"./assets/img/pokeball.png",female:e.sprites.front_female||"./assets/img/pokeball.png"}};return i}}}]),angular.module("pokemon").factory("PokemonEvolutionFactory",["$http",function(e){return{getEvolutionChain:function(o){return e.get(o)}}}]),angular.module("pokemon").factory("PokemonNameFactory",["$http","lodash",function(e,o){var n=function(e){var o=e.map(function(e){return e.name});return o};return{getAllNames:function(o){e.get("//pokeapi.co/api/v2/pokemon/").then(function(t){var a=t.data.count;e.get("//pokeapi.co/api/v2/pokemon/?limit="+a,{cache:!0}).then(function(e){o(null,n(e.data.results))}).then(function(e){o(e)})}).then(function(e){o(e)})}}}]),angular.module("pokemon").factory("PokemonSpeciesFactory",["$http",function(e){var o=function(e){return null===e?null:e.name};return{getSpecies:function(o){return e.get(o)},parseSpecies:function(e){var n={name:e.name,genderRate:{female:100*(e.gender_rate/8).toFixed(1)+"%",male:100*((8-e.gender_rate)/8).toFixed(1)+"%"},captureRate:e.capture_rate,growthRate:e.growth_rate.name,color:e.color.name,evolutionChainUrl:e.evolution_chain.url,generation:e.generation.name,habitat:o(e.habitat)||"unavailable",genus:e.genera[0].genus,varieties:e.varieties};return n}}}]),angular.module("pokemon").filter("titlecase",["lodash",function(e){return function(o){var n=o.split("-"),t=n.map(function(o){return e.capitalize(o)}),a=t.join(" ");return a}}]);